## 1.Nosql概述

 ### 1.1产生背景

当代典型的[关系数据库](https://zh.wikipedia.org/wiki/關聯式資料庫)在一些数据敏感的应用中表现了糟糕的性能，例如为巨量文档创建索引、高流量网站的[网页服务](https://zh.wikipedia.org/wiki/Web服务)，以及发送[流式媒体](https://zh.wikipedia.org/wiki/流式媒体)[[5\]](https://zh.wikipedia.org/wiki/NoSQL#cite_note-Agrawal2008-5)。关系型数据库的典型实现主要被调整用于执行规模小而读写频繁，或者大批量读而极少写访问的事务[[1\]]([https://zh.wikipedia.org/wiki/NoSQL#%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2](https://zh.wikipedia.org/wiki/NoSQL#发展历史))

再加上社交网络类的图数据等复杂的交叉关系存在，仅靠Mysql进行主从复制、分库分表、集群都不能应付实时(Velocity)、海量(Volumn)和多样(Variety)的数据流。为了解决这样的僵局，**打破关系型数据库**中的**关系**和以表为主的**存储格式**的**局限**，引入了Nosql来解决这样的问题。

### 1.2 基本概念

#### 1.2.1 定义

NoSQL(NoSQL = Not Only SQL )，意即“不仅仅是SQL”，泛指非关系型的数据库。引入了许多非关系型的存储类型，这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。

#### 1.2.2 数据库分类

对应于上面的四种存储结构，数据库对应有如下四种分类

##### 1）K-V数据库

###### （1）K-V

即以键值对的形式存储在数据库中，其中键一般为字符串类型，值可以为任意类型，有很大的扩展空间。

> Redis就是利用这一点支持了多种的数据结构，相较于memcache更加灵活方便

###### （2）常见数据库

Redis、memcache

##### 2）文档型数据库（BSON为主）

###### （1）BSON

是一种类似于json的二进制形式的存储格式，简称Binary JSON，它和JSON一样，支持内嵌的文档对象和数组对象

###### （2）常见数据库

MongoDB

##### 3）列存储数据库

###### （1）列族

是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。

###### （2）常见数据库

HBase

##### 4）图关系数据库

###### （1）图

以图的形式存储，最典型的应用是社交网络

###### （2）常见数据库

Neo4J

### 1.3 CAP理论

#### 1.3.1基本概念

**CAP定理**（CAP theorem），又被称作**布鲁尔定理**（Brewer's theorem），它指出对于一个[分布式计算系统](https://zh.wikipedia.org/wiki/分布式计算)来说，不可能同时满足以下三点：

- 一致性（**C**onsistency） （等同于所有节点访问同一份**最新的数据副本**）
- 可用性（**A**vailability）（每次请求都能获取到非错的响应——但是**不保证获取的数据为最新数据**）
- 分区容错性（**P**artition tolerance）（系统如果**不能在时限内达成数据一致性，就意味着发生了分区的情况**，必须就当前操作在C和A之间做出选择[[3\]](https://zh.wikipedia.org/wiki/CAP定理#cite_note-3)。）

下面对这三个性质做出解释

:one: **一致性** **C**

也可以理解为原子性，代表持久化到数据库中的数据必定是最新且正确的。

> 对于一般的单点Mysql数据库，由于不存在分布式系统且有着ACID特性的支持，一般都具有较好的一致性

:two: **可用性** **A**

在高并发的场景下，如果可以提供最有效但不一定是最新的数据，就代表支持可用性

:three: **分区容错性** **P**

分区容错性一般指一个大的分布式系统对外表现为一个整体的系统，但是内部有许多分区存在，为了保证在某个节点宕机后仍然能查询到数据，往往会把一份数据拷贝到多个节点中，那么向该系统发出一次请求时，如果恰好对应节点宕机，如果能在足够短的时间内从别的节点中查询到数据，那么就是具有分区容错性的，否则就不支持。

从上面可以看出，分布式系统只能满足三项中的两项而不可能满足全部三项

如果满足**CA**，那么代表是一个单点集群系统，可以支持强一致性和可用性，在分布式系统下，不可能保证每个节点都是**CA**的，所以不满足**P**--Mysql

如果满足**AP**，那么代表是一个高可用且分布式的系统，在这种情况下，为了保证高可用，一般是将一条信息在多个节点中存储大量的拷贝，这样就可以实现高可用，但是对于大量副本的情况下，很难保证一致性，因而牺牲了C

如果满足**CP**，那么代表是一个强一致性的分布式系统，在这种情况下，为了保证强一致性，就会尽量减少副本数量且保证每个副本的数据都是最新且正确的，但这样就不可能达到高可用，在保证一致性的过程中就牺牲了大量的效率 -- redis/mongodb

#### 1.3.2 BASE理论

BASE就是为了解决关系数据库**强一致性**引起的问题而引起的可用性降低而提出的解决方案。

BASE即：  基本可用（**B**asically **A**vailable）  软状态（**S**oft state）  最终一致（**E**ventually consistent）它的思想是通过让系统放松对某一时刻数据一致性的要求来换取系统整体伸缩性和性能上改观。由于大型系统往往由于地域分布和极高性能的要求，不可能采用分布式事务来完成这些指标，要想获得这些指标，最佳准则就是满足BASE的要求

#### 1.3.3 趋势

为了更好的应对高并发的场景，一般都是保证AP，引入了**最终一致性**的概念。

但是对于Redis来说，其存在的目的是为了降低Mysql的读写压力以及提高访问其他非关系型数据的访问效率，一般存在于DAO和Mysql之间，且必须要保证数据是准确的，因而必须要保证是CP的。

### 1.4 分布式和集群

#### 1.4.1 分布式[[引用](https://www.cnblogs.com/xybaby/p/7787034.html#_label_0)]

分布式系统是由一组通过网络进行通信、为了完成共同的任务而协调工作的计算机节点组成的系统。分布式系统的出现是为了用廉价的、普通的机器完成单个计算机无法完成的计算、存储任务。其目的是**利用更多的机器，处理更多的数据**

典型的例子为微服务

#### 1.4.2 集群

通过将多个机器划分成一个群体并共同来完成一项工作（如数据存储），并通过负载均衡器将工作压力（如存储压力）分配到不同的机器上，这样作为一个整体就可以更好的支持更大的工作量（如数据量）

























